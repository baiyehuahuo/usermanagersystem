(function(){"use strict";var e={8530:function(e,t,o){var s=o(8935),a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},["LoginView"!=e.$route.name?o("nav",[o("router-link",{attrs:{to:"/"}},[e._v("Home")]),e._v(" | "),o("router-link",{attrs:{to:"/login"}},[e._v("Login")])],1):e._e(),o("router-view")],1)},r=[],l={mounted(){this.$http.get("/GetUserMessage").then((e=>{console.log("App.vue /getUserMessage",e),200==e.status&&this.$store.commit("login",e.data)})).catch((e=>{console.error("App.vue /getUserMessage",e),this.$store.commit("logout"),this.$router.push({name:"LoginView"})})).finally((()=>{this.$router.beforeEach(((e,t,o)=>{"LoginView"==e.name||this.$store.state.auth||(console.log("beforeEach() redirect to LoginView"),o({name:"LoginView"})),o()}))}))}},i=l,n=o(1001),c=(0,n.Z)(i,a,r,!1,null,null,null),d=c.exports,m=o(4549),u=o.n(m);s["default"].use(u());var p=o(2809),f=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"home"},[o("el-card",{staticClass:"card"},[o("el-row",{attrs:{gutter:40}},[o("el-col",{attrs:{span:6}},[e.uploadAvatar.visible?o("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.$http.defaults.baseURL+"/UploadAvatar",name:"avatar","with-credentials":"","show-file-list":!1,"before-upload":e.beforeAvatarUpload,"http-request":e.onAvatarUpload}},[o("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]):o("img",{staticClass:"avatar",attrs:{alt:"Avatar",src:"http://"+e.$store.state.avatarPath}})],1),o("el-col",{attrs:{span:18}},[o("el-descriptions",{attrs:{title:"用户信息",colon:!1,direction:"vertical",size:"medium",border:""}},[o("template",{slot:"extra"},[o("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.updatePasswordForm.dialogVisible=!0}}},[e._v(" 修改密码 ")]),o("el-button",{attrs:{type:e.uploadAvatar.visible?"info":"primary",size:"small"},on:{click:function(t){e.uploadAvatar.visible=!e.uploadAvatar.visible}}},[e._v(" "+e._s(e.uploadAvatar.visible?"取消修改":"修改头像")+" ")])],1),o("el-descriptions-item",{attrs:{label:"账号"}},[e._v(" "+e._s(e.$store.state.account)+" ")]),o("el-descriptions-item",{attrs:{label:"邮箱"}},[e._v(" "+e._s(e.$store.state.email)+" ")]),o("el-descriptions-item",{attrs:{label:"昵称"}},[e._v(" "+e._s(e.$store.state.nickname)+" ")])],2)],1)],1)],1),o("el-dialog",{attrs:{center:"",title:"修改密码",visible:e.updatePasswordForm.dialogVisible,width:"400px"},on:{"update:visible":function(t){return e.$set(e.updatePasswordForm,"dialogVisible",t)},close:e.clearUpdatePasswordForm}},[o("el-form",{ref:"updatePasswordForm",attrs:{model:e.updatePasswordForm,rules:e.updatePasswordForm.rules}},[o("el-form-item",{attrs:{prop:"oldPassword"}},[o("template",{slot:"label"},[o("strong",[e._v("旧密码")])]),o("el-input",{attrs:{placeholder:"请输入旧密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.updatePasswordForm.oldPassword,callback:function(t){e.$set(e.updatePasswordForm,"oldPassword",t)},expression:"updatePasswordForm.oldPassword"}})],2),o("el-form-item",{attrs:{prop:"newPassword"}},[o("template",{slot:"label"},[o("strong",[e._v("新密码")])]),o("el-input",{attrs:{placeholder:"请输入新密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.updatePasswordForm.newPassword,callback:function(t){e.$set(e.updatePasswordForm,"newPassword",t)},expression:"updatePasswordForm.newPassword"}})],2),o("el-form-item",{attrs:{prop:"confirmNewPassword"}},[o("template",{slot:"label"},[o("strong",[e._v("确认新密码")])]),o("el-input",{attrs:{placeholder:"请确认新密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.updatePasswordForm.confirmNewPassword,callback:function(t){e.$set(e.updatePasswordForm,"confirmNewPassword",t)},expression:"updatePasswordForm.confirmNewPassword"}})],2)],1),o("template",{slot:"footer"},[o("el-button",{staticStyle:{width:"100%"},attrs:{loading:e.updatePasswordForm.loading,type:"primary"},on:{click:e.updatePassword}},[e._v(" 修改密码 ")])],1)],2)],1)},g=[],w=(o(1703),o(6166)),h=o.n(w),v={data(){const e=e=>({required:!0,message:e,trigger:"blur"});return{uploadAvatar:{visible:!1},updatePasswordForm:{loading:!1,dialogVisible:!1,oldPassword:"",newPassword:"",confirmNewPassword:"",rules:{oldPassword:[e("请输入旧密码")],newPassword:[e("请输入新密码"),{validator:(e,t,o)=>{this.updatePasswordForm.oldPassword!==t?o():o(new Error("新旧密码不能一样"))}}],confirmNewPassword:[e("去重复新密码"),{validator:(e,t,o)=>{this.updatePasswordForm.newPassword===t?o():o(new Error("两次密码不一致"))}}]}}}},methods:{onAvatarUpload(e){console.log(e.filename,e.file.type,e.file.size);const t=new FormData;t.append("avatar",e.file),h().post("/UploadAvatar",t).then((e=>{console.log("HomeView.vue onAvatarUpload",e),this.$message({showClose:!0,message:e.data,type:200==e.status?"success":"error"}),200==e.status&&this.$http.get("/GetUserMessage").then((e=>{console.log("App.vue /getUserMessage",e),200==e.status&&this.$store.commit("login",e.data),window.location.reload()})).catch((e=>{console.error("App.vue /getUserMessage",e),this.$store.commit("logout"),this.$router.push({name:"LoginView"})}))})).catch((e=>{console.error("HomeView.vue onAvatarUpload",e),this.$message.error({showClose:!0,message:e.message})}))},beforeAvatarUpload(e){const t=/^image/.test(e.type),o=e.size/1024/1024<2;return t?o||this.$message.error({showClose:!0,message:"上传头像图片大小不能超过 2MB"}):this.$message.error({showClose:!0,message:"请上传头像图片"}),t&&o},clearUpdatePasswordForm(){this.updatePasswordForm.oldPassword="",this.updatePasswordForm.newPassword="",this.updatePasswordForm.confirmNewPassword=""},updatePassword(){let e;if(this.$refs.updatePasswordForm.validate((t=>e=t)),console.log("HomeView.vue updatePassword() passed validation?",e),!e)return;this.updatePasswordForm.loading=!0;const t=new FormData;t.append("oldPassword",this.updatePasswordForm.oldPassword),t.append("newPassword",this.updatePasswordForm.newPassword),this.$http.post("/ModifyPassword",t).then((e=>{console.log("HomeView.vue updatePassword /ModifyPassword",e),this.$message({showClose:!0,message:e.data,type:200==e.status?"success":"error"}),200==e.status&&(this.updatePasswordForm.dialogVisible=!1,this.clearUpdatePasswordForm())})).catch((e=>{console.error("HomeView.vue updatePassword /ModifyPassword",e),this.$message({showClose:!0,message:e.message,type:"error"})})).finally((()=>this.updatePasswordForm.loading=!1))}}},b=v,P=(0,n.Z)(b,f,g,!1,null,"646a4274",null),y=P.exports,$=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-container",{staticClass:"container"},[o("login-form")],1)},F=[],k=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-card",{staticClass:"login-card"},[o("el-tabs",{attrs:{stretch:""},on:{"tab-click":e.clearForm},model:{value:e.activePanel,callback:function(t){e.activePanel=t},expression:"activePanel"}},[o("el-tab-pane",{attrs:{label:"登陆",name:"login"}},[o("el-form",{ref:"loginForm",staticClass:"login-form",attrs:{model:e.form,rules:e.form.loginRules},nativeOn:{submit:function(t){return t.preventDefault(),e.login.apply(null,arguments)}}},[o("el-form-item",{attrs:{prop:"account"}},[o("template",{slot:"label"},[o("strong",[e._v("账号")])]),o("el-input",{attrs:{placeholder:"请输入账号","prefix-icon":"el-icon-user",clearable:""},model:{value:e.form.account,callback:function(t){e.$set(e.form,"account",t)},expression:"form.account"}})],2),o("el-form-item",{attrs:{prop:"password"}},[o("template",{slot:"label"},[o("strong",[e._v("密码")])]),o("el-input",{attrs:{placeholder:"请输入密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],2),o("el-form-item",[o("el-button",{staticClass:"login-button",attrs:{loading:e.form.loading,type:"primary","native-type":"submit",block:""}},[e._v("登陆")])],1),o("el-link",{staticClass:"forgot-password",attrs:{type:"info"}},[e._v("忘记密码？")])],1)],1),o("el-tab-pane",{attrs:{label:"注册",name:"register"}},[o("el-form",{ref:"registerForm",staticClass:"login-form",attrs:{model:e.form,rules:e.form.registerRules},nativeOn:{submit:function(t){return t.preventDefault(),e.register.apply(null,arguments)}}},[o("el-form-item",{attrs:{prop:"account"}},[o("template",{slot:"label"},[o("strong",[e._v("账号")])]),o("el-input",{attrs:{placeholder:"请输入账号","prefix-icon":"el-icon-user",clearable:""},model:{value:e.form.account,callback:function(t){e.$set(e.form,"account",t)},expression:"form.account"}})],2),o("el-form-item",{attrs:{prop:"email"}},[o("template",{slot:"label"},[o("strong",[e._v("邮箱地址")])]),o("el-input",{attrs:{placeholder:"请输入邮箱","prefix-icon":"el-icon-user",clearable:""},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],2),o("el-form-item",{attrs:{prop:"nickname"}},[o("template",{slot:"label"},[o("strong",[e._v("昵称（可选）")])]),o("el-input",{attrs:{placeholder:"请输入昵称","prefix-icon":"el-icon-user",clearable:""},model:{value:e.form.nickname,callback:function(t){e.$set(e.form,"nickname",t)},expression:"form.nickname"}})],2),o("el-form-item",{attrs:{prop:"password"}},[o("template",{slot:"label"},[o("strong",[e._v("密码")])]),o("el-input",{attrs:{placeholder:"请输入密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],2),o("el-form-item",{attrs:{prop:"confirmPassword"}},[o("template",{slot:"label"},[o("strong",[e._v("确认密码")])]),o("el-input",{attrs:{placeholder:"请确认密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.form.confirmPassword,callback:function(t){e.$set(e.form,"confirmPassword",t)},expression:"form.confirmPassword"}})],2),o("el-form-item",[o("el-button",{staticClass:"login-button",attrs:{loading:e.form.loading,type:"primary","native-type":"submit",block:""}},[e._v(" 注册 ")])],1),o("el-link",{staticClass:"forgot-password",attrs:{type:"info"}},[e._v("忘记密码？")])],1)],1)],1)],1)},_=[],x={data(){const e={account:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]};return{activePanel:"login",form:{account:"",email:"",nickname:"",password:"",confirmPassword:"",loading:!1,loginRules:e,registerRules:{...e,email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:(e,t,o)=>{this.validateEmail(t)?o():o(new Error("错误的邮箱格式"))},trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,t,o)=>{this.form.password===t?o():o(new Error("两次密码不一致"))}}]}}}},methods:{clearForm(){this.form.account="",this.form.email="",this.form.nickname="",this.form.password="",this.form.confirmPassword="",this.form.loading=!1},validateEmail(e){return String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)},async login(){let e;if(this.$refs.loginForm.validate((t=>e=t)),console.log("LoginForm login() passed validation?",e),!e)return;this.form.loading=!0;const t=new URLSearchParams;t.append("account",this.form.account),t.append("password",this.form.password),await this.$http.get("/UserLogin?"+t).then((e=>{console.log("LoginForm login() /UserLogin?"+t,e),this.$message({showClose:!0,message:e.data,type:200==e.status?"success":"error"}),200==e.status&&this.$http.get("/GetUserMessage").then((e=>{console.log("LoginForm.vue /getUserMessage",e),200==e.status&&(this.$store.commit("login",e.data),this.$router.push({name:"HomeView"}))})).catch((e=>{console.error("LoginForm.vue /getUserMessage",e)}))})).catch((e=>{console.error("LoginForm login() /UserLogin?"+t,e),this.$message({showClose:!0,message:e.message,type:"error"})})),this.form.loading=!1},async register(){let e;if(this.$refs.registerForm.validate((t=>e=t)),console.log("LoginForm register() passed validation?",e),!e)return;this.form.loading=!0;const t=new URLSearchParams;t.append("account",this.form.account),t.append("password",this.form.password),t.append("email",this.form.email),t.append("nick_name",""==this.form.nickname?this.form.account:this.form.nickname),await this.$http.get("/UserRegister?"+t).then((e=>{console.log("LoginForm register() /UserRegister?"+t,e),this.$message({showClose:!0,message:e.data,type:200==e.status?"success":"error"}),200==e.status&&(this.activePanel="login",this.form.password="")})).catch((e=>{console.error("LoginForm register() /UserRegister?"+t,e),this.$message({showClose:!0,message:e.message,type:"error"})})),this.form.loading=!1}},mounted(){}},U=x,C=(0,n.Z)(U,k,_,!1,null,"7d37ee1e",null),L=C.exports,A={components:{"login-form":L}},V=A,M=(0,n.Z)(V,$,F,!1,null,null,null),O=M.exports;s["default"].use(p.Z);const E=[{path:"/",name:"HomeView",component:y},{path:"/login",name:"LoginView",component:O}],R=new p.Z({routes:E});var S=R,Z=o(4665);s["default"].use(Z.ZP);var j=new Z.ZP.Store({state:{auth:!1,account:"",avatarPath:"",email:"",nickname:""},getters:{},mutations:{login(e,{account:t,avatar_path:o,email:s,nick_name:a}){e.auth=!0,e.account=t,e.avatarPath=o,e.email=s,e.nickname=a},logout(e){e.auth=!1,e.account="",e.avatarPath="",e.email="",e.nickname=""}},actions:{},modules:{}});s["default"].config.productionTip=!1,s["default"].prototype.$http=h(),h().defaults.withCredentials=!0,h().defaults.baseURL="http://localhost:8080",new s["default"]({router:S,store:j,render:e=>e(d)}).$mount("#app")}},t={};function o(s){var a=t[s];if(void 0!==a)return a.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,o),r.exports}o.m=e,function(){var e=[];o.O=function(t,s,a,r){if(!s){var l=1/0;for(d=0;d<e.length;d++){s=e[d][0],a=e[d][1],r=e[d][2];for(var i=!0,n=0;n<s.length;n++)(!1&r||l>=r)&&Object.keys(o.O).every((function(e){return o.O[e](s[n])}))?s.splice(n--,1):(i=!1,r<l&&(l=r));if(i){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[s,a,r]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,s){var a,r,l=s[0],i=s[1],n=s[2],c=0;if(l.some((function(t){return 0!==e[t]}))){for(a in i)o.o(i,a)&&(o.m[a]=i[a]);if(n)var d=n(o)}for(t&&t(s);c<l.length;c++)r=l[c],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return o.O(d)},s=self["webpackChunkdachuang"]=self["webpackChunkdachuang"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=o.O(void 0,[998],(function(){return o(8530)}));s=o.O(s)})();
//# sourceMappingURL=app.e4f75ccb.js.map