(function(){"use strict";var e={8530:function(e,o,t){t(6992),t(8674),t(9601),t(7727);var r=t(8935),a=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{attrs:{id:"app"}},["LoginView"!=e.$route.name?t("nav",[t("router-link",{attrs:{to:"/"}},[e._v("Home")]),e._v(" | "),t("router-link",{attrs:{to:"/login"}},[e._v("Login")])],1):e._e(),t("router-view")],1)},s=[],n=(t(1539),t(8309),{mounted:function(){var e=this;this.$http.get("/GetUserMessage").then((function(o){console.log("App.vue /getUserMessage",o),200==o.status&&e.$store.commit("login",o.data)})).catch((function(o){console.error("App.vue /getUserMessage",o),e.$store.commit("logout"),e.$router.push({name:"LoginView"})})).finally((function(){e.$router.beforeEach((function(o,t,r){"LoginView"==o.name||e.$store.state.auth||(console.log("beforeEach() redirect to LoginView"),r({name:"LoginView"})),r()}))}))}}),l=n,i=t(1001),c=(0,i.Z)(l,a,s,!1,null,null,null),u=c.exports,d=t(4549),m=t.n(d);r["default"].use(m());var p=t(2809),f=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"home"},[t("el-card",{staticClass:"card"},[t("el-row",{attrs:{gutter:40}},[t("el-col",{attrs:{span:6}},[e.uploadAvatar.visible?t("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.$http.defaults.baseURL+"/UploadAvatar",name:"avatar","with-credentials":"","show-file-list":!1,"before-upload":e.beforeAvatarUpload,"http-request":e.onAvatarUpload}},[t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]):t("img",{staticClass:"avatar",attrs:{alt:"Avatar",src:"http://"+e.$store.state.avatarPath}})],1),t("el-col",{attrs:{span:18}},[t("el-descriptions",{attrs:{title:"用户信息",colon:!1,direction:"vertical",size:"medium",border:""}},[t("template",{slot:"extra"},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(o){e.updatePasswordForm.dialogVisible=!0}}},[e._v(" 修改密码 ")]),t("el-button",{attrs:{type:e.uploadAvatar.visible?"info":"primary",size:"small"},on:{click:function(o){e.uploadAvatar.visible=!e.uploadAvatar.visible}}},[e._v(" "+e._s(e.uploadAvatar.visible?"取消修改":"修改头像")+" ")])],1),t("el-descriptions-item",{attrs:{label:"账号"}},[e._v(" "+e._s(e.$store.state.account)+" ")]),t("el-descriptions-item",{attrs:{label:"邮箱"}},[e._v(" "+e._s(e.$store.state.email)+" ")]),t("el-descriptions-item",{attrs:{label:"昵称"}},[e._v(" "+e._s(e.$store.state.nickname)+" ")])],2)],1)],1)],1),t("el-dialog",{attrs:{center:"",title:"修改密码",visible:e.updatePasswordForm.dialogVisible,width:"400px"},on:{"update:visible":function(o){return e.$set(e.updatePasswordForm,"dialogVisible",o)},close:e.clearUpdatePasswordForm}},[t("el-form",{ref:"updatePasswordForm",attrs:{model:e.updatePasswordForm,rules:e.updatePasswordForm.rules}},[t("el-form-item",{attrs:{prop:"oldPassword"}},[t("template",{slot:"label"},[t("strong",[e._v("旧密码")])]),t("el-input",{attrs:{placeholder:"请输入旧密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.updatePasswordForm.oldPassword,callback:function(o){e.$set(e.updatePasswordForm,"oldPassword",o)},expression:"updatePasswordForm.oldPassword"}})],2),t("el-form-item",{attrs:{prop:"newPassword"}},[t("template",{slot:"label"},[t("strong",[e._v("新密码")])]),t("el-input",{attrs:{placeholder:"请输入新密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.updatePasswordForm.newPassword,callback:function(o){e.$set(e.updatePasswordForm,"newPassword",o)},expression:"updatePasswordForm.newPassword"}})],2),t("el-form-item",{attrs:{prop:"confirmNewPassword"}},[t("template",{slot:"label"},[t("strong",[e._v("确认新密码")])]),t("el-input",{attrs:{placeholder:"请确认新密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.updatePasswordForm.confirmNewPassword,callback:function(o){e.$set(e.updatePasswordForm,"confirmNewPassword",o)},expression:"updatePasswordForm.confirmNewPassword"}})],2)],1),t("template",{slot:"footer"},[t("el-button",{staticStyle:{width:"100%"},attrs:{loading:e.updatePasswordForm.loading,type:"primary"},on:{click:e.updatePassword}},[e._v(" 修改密码 ")])],1)],2)],1)},g=[],w=(t(1703),t(4916),t(7601),t(6166)),v=t.n(w),h={data:function(){var e=this,o=function(e){return{required:!0,message:e,trigger:"blur"}};return{uploadAvatar:{visible:!1},updatePasswordForm:{loading:!1,dialogVisible:!1,oldPassword:"",newPassword:"",confirmNewPassword:"",rules:{oldPassword:[o("请输入旧密码")],newPassword:[o("请输入新密码"),{validator:function(o,t,r){e.updatePasswordForm.oldPassword!==t?r():r(new Error("新旧密码不能一样"))}}],confirmNewPassword:[o("去重复新密码"),{validator:function(o,t,r){e.updatePasswordForm.newPassword===t?r():r(new Error("两次密码不一致"))}}]}}}},methods:{onAvatarUpload:function(e){var o=this;console.log(e.filename,e.file.type,e.file.size);var t=new FormData;t.append("avatar",e.file),v().post("/UploadAvatar",t).then((function(e){console.log("HomeView.vue onAvatarUpload",e),o.$message({showClose:!0,message:e.data,type:200==e.status?"success":"error"}),200==e.status&&o.$http.get("/GetUserMessage").then((function(e){console.log("App.vue /getUserMessage",e),200==e.status&&o.$store.commit("login",e.data),window.location.reload()})).catch((function(e){console.error("App.vue /getUserMessage",e),o.$store.commit("logout"),o.$router.push({name:"LoginView"})}))})).catch((function(e){console.error("HomeView.vue onAvatarUpload",e),o.$message.error({showClose:!0,message:e.message})}))},beforeAvatarUpload:function(e){var o=/^image/.test(e.type),t=e.size/1024/1024<2;return o?t||this.$message.error({showClose:!0,message:"上传头像图片大小不能超过 2MB"}):this.$message.error({showClose:!0,message:"请上传头像图片"}),o&&t},clearUpdatePasswordForm:function(){this.updatePasswordForm.oldPassword="",this.updatePasswordForm.newPassword="",this.updatePasswordForm.confirmNewPassword=""},updatePassword:function(){var e,o=this;if(this.$refs.updatePasswordForm.validate((function(o){return e=o})),console.log("HomeView.vue updatePassword() passed validation?",e),e){this.updatePasswordForm.loading=!0;var t=new FormData;t.append("oldPassword",this.updatePasswordForm.oldPassword),t.append("newPassword",this.updatePasswordForm.newPassword),this.$http.post("/ModifyPassword",t).then((function(e){console.log("HomeView.vue updatePassword /ModifyPassword",e),o.$message({showClose:!0,message:e.data,type:200==e.status?"success":"error"}),200==e.status&&(o.updatePasswordForm.dialogVisible=!1,o.clearUpdatePasswordForm())})).catch((function(e){console.error("HomeView.vue updatePassword /ModifyPassword",e),o.$message({showClose:!0,message:e.message,type:"error"})})).finally((function(){return o.updatePasswordForm.loading=!1}))}}}},b=h,P=(0,i.Z)(b,f,g,!1,null,"646a4274",null),$=P.exports,y=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("el-container",{staticClass:"container"},[t("login-form")],1)},k=[],F=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("el-card",{staticClass:"login-card"},[t("el-tabs",{attrs:{stretch:""},on:{"tab-click":e.clearForm},model:{value:e.activePanel,callback:function(o){e.activePanel=o},expression:"activePanel"}},[t("el-tab-pane",{attrs:{label:"登陆",name:"login"}},[t("el-form",{ref:"loginForm",staticClass:"login-form",attrs:{model:e.form,rules:e.form.loginRules},nativeOn:{submit:function(o){return o.preventDefault(),e.login.apply(null,arguments)}}},[t("el-form-item",{attrs:{prop:"account"}},[t("template",{slot:"label"},[t("strong",[e._v("账号")])]),t("el-input",{attrs:{placeholder:"请输入账号","prefix-icon":"el-icon-user",clearable:""},model:{value:e.form.account,callback:function(o){e.$set(e.form,"account",o)},expression:"form.account"}})],2),t("el-form-item",{attrs:{prop:"password"}},[t("template",{slot:"label"},[t("strong",[e._v("密码")])]),t("el-input",{attrs:{placeholder:"请输入密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.form.password,callback:function(o){e.$set(e.form,"password",o)},expression:"form.password"}})],2),t("el-form-item",[t("el-button",{staticClass:"login-button",attrs:{loading:e.form.loading,type:"primary","native-type":"submit",block:""}},[e._v("登陆")])],1),t("el-link",{staticClass:"forgot-password",attrs:{type:"info"}},[e._v("忘记密码？")])],1)],1),t("el-tab-pane",{attrs:{label:"注册",name:"register"}},[t("el-form",{ref:"registerForm",staticClass:"login-form",attrs:{model:e.form,rules:e.form.registerRules},nativeOn:{submit:function(o){return o.preventDefault(),e.register.apply(null,arguments)}}},[t("el-form-item",{attrs:{prop:"account"}},[t("template",{slot:"label"},[t("strong",[e._v("账号")])]),t("el-input",{attrs:{placeholder:"请输入账号","prefix-icon":"el-icon-user",clearable:""},model:{value:e.form.account,callback:function(o){e.$set(e.form,"account",o)},expression:"form.account"}})],2),t("el-form-item",{attrs:{prop:"email"}},[t("template",{slot:"label"},[t("strong",[e._v("邮箱地址")])]),t("el-input",{attrs:{placeholder:"请输入邮箱","prefix-icon":"el-icon-user",clearable:""},model:{value:e.form.email,callback:function(o){e.$set(e.form,"email",o)},expression:"form.email"}})],2),t("el-form-item",{attrs:{prop:"nickname"}},[t("template",{slot:"label"},[t("strong",[e._v("昵称（可选）")])]),t("el-input",{attrs:{placeholder:"请输入昵称","prefix-icon":"el-icon-user",clearable:""},model:{value:e.form.nickname,callback:function(o){e.$set(e.form,"nickname",o)},expression:"form.nickname"}})],2),t("el-form-item",{attrs:{prop:"password"}},[t("template",{slot:"label"},[t("strong",[e._v("密码")])]),t("el-input",{attrs:{placeholder:"请输入密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.form.password,callback:function(o){e.$set(e.form,"password",o)},expression:"form.password"}})],2),t("el-form-item",{attrs:{prop:"confirmPassword"}},[t("template",{slot:"label"},[t("strong",[e._v("确认密码")])]),t("el-input",{attrs:{placeholder:"请确认密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.form.confirmPassword,callback:function(o){e.$set(e.form,"confirmPassword",o)},expression:"form.confirmPassword"}})],2),t("el-form-item",[t("el-button",{staticClass:"login-button",attrs:{loading:e.form.loading,type:"primary","native-type":"submit",block:""}},[e._v(" 注册 ")])],1),t("el-link",{staticClass:"forgot-password",attrs:{type:"info"}},[e._v("忘记密码？")])],1)],1)],1)],1)},_=[],x=t(6198),U=t(3019),C=(t(8975),t(4723),t(8783),t(3948),t(1637),{data:function(){var e=this,o={account:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]};return{activePanel:"login",form:{account:"",email:"",nickname:"",password:"",confirmPassword:"",loading:!1,loginRules:o,registerRules:(0,U.Z)((0,U.Z)({},o),{},{email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:function(o,t,r){e.validateEmail(t)?r():r(new Error("错误的邮箱格式"))},trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:function(o,t,r){e.form.password===t?r():r(new Error("两次密码不一致"))}}]})}}},methods:{clearForm:function(){this.form.account="",this.form.email="",this.form.nickname="",this.form.password="",this.form.confirmPassword="",this.form.loading=!1},validateEmail:function(e){return String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)},login:function(){var e=this;return(0,x.Z)(regeneratorRuntime.mark((function o(){var t,r;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(e.$refs.loginForm.validate((function(e){return t=e})),console.log("LoginForm login() passed validation?",t),t){o.next=4;break}return o.abrupt("return");case 4:return e.form.loading=!0,r=new URLSearchParams,r.append("account",e.form.account),r.append("password",e.form.password),o.next=10,e.$http.get("/UserLogin?"+r).then((function(o){console.log("LoginForm login() /UserLogin?"+r,o),e.$message({showClose:!0,message:o.data,type:200==o.status?"success":"error"}),200==o.status&&e.$http.get("/GetUserMessage").then((function(o){console.log("LoginForm.vue /getUserMessage",o),200==o.status&&(e.$store.commit("login",o.data),e.$router.push({name:"HomeView"}))})).catch((function(e){console.error("LoginForm.vue /getUserMessage",e)}))})).catch((function(o){console.error("LoginForm login() /UserLogin?"+r,o),e.$message({showClose:!0,message:o.message,type:"error"})}));case 10:e.form.loading=!1;case 11:case"end":return o.stop()}}),o)})))()},register:function(){var e=this;return(0,x.Z)(regeneratorRuntime.mark((function o(){var t,r;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(e.$refs.registerForm.validate((function(e){return t=e})),console.log("LoginForm register() passed validation?",t),t){o.next=4;break}return o.abrupt("return");case 4:return e.form.loading=!0,r=new URLSearchParams,r.append("account",e.form.account),r.append("password",e.form.password),r.append("email",e.form.email),r.append("nick_name",""==e.form.nickname?e.form.account:e.form.nickname),o.next=12,e.$http.get("/UserRegister?"+r).then((function(o){console.log("LoginForm register() /UserRegister?"+r,o),e.$message({showClose:!0,message:o.data,type:200==o.status?"success":"error"}),200==o.status&&(e.activePanel="login",e.form.password="")})).catch((function(o){console.error("LoginForm register() /UserRegister?"+r,o),e.$message({showClose:!0,message:o.message,type:"error"})}));case 12:e.form.loading=!1;case 13:case"end":return o.stop()}}),o)})))()}},mounted:function(){}}),L=C,A=(0,i.Z)(L,F,_,!1,null,"7d37ee1e",null),V=A.exports,M={components:{"login-form":V}},O=M,R=(0,i.Z)(O,y,k,!1,null,null,null),Z=R.exports;r["default"].use(p.Z);var E=[{path:"/",name:"HomeView",component:$},{path:"/login",name:"LoginView",component:Z}],S=new p.Z({routes:E}),j=S,H=t(4665);r["default"].use(H.ZP);var z=new H.ZP.Store({state:{auth:!1,account:"",avatarPath:"",email:"",nickname:""},getters:{},mutations:{login:function(e,o){var t=o.account,r=o.avatar_path,a=o.email,s=o.nick_name;e.auth=!0,e.account=t,e.avatarPath=r,e.email=a,e.nickname=s},logout:function(e){e.auth=!1,e.account="",e.avatarPath="",e.email="",e.nickname=""}},actions:{},modules:{}});r["default"].config.productionTip=!1,r["default"].prototype.$http=v(),v().defaults.withCredentials=!0,v().defaults.baseURL="http://localhost:8080",new r["default"]({router:j,store:z,render:function(e){return e(u)}}).$mount("#app")}},o={};function t(r){var a=o[r];if(void 0!==a)return a.exports;var s=o[r]={id:r,loaded:!1,exports:{}};return e[r](s,s.exports,t),s.loaded=!0,s.exports}t.m=e,function(){var e=[];t.O=function(o,r,a,s){if(!r){var n=1/0;for(u=0;u<e.length;u++){r=e[u][0],a=e[u][1],s=e[u][2];for(var l=!0,i=0;i<r.length;i++)(!1&s||n>=s)&&Object.keys(t.O).every((function(e){return t.O[e](r[i])}))?r.splice(i--,1):(l=!1,s<n&&(n=s));if(l){e.splice(u--,1);var c=a();void 0!==c&&(o=c)}}return o}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[r,a,s]}}(),function(){t.n=function(e){var o=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(o,{a:o}),o}}(),function(){t.d=function(e,o){for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={143:0};t.O.j=function(o){return 0===e[o]};var o=function(o,r){var a,s,n=r[0],l=r[1],i=r[2],c=0;if(n.some((function(o){return 0!==e[o]}))){for(a in l)t.o(l,a)&&(t.m[a]=l[a]);if(i)var u=i(t)}for(o&&o(r);c<n.length;c++)s=n[c],t.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return t.O(u)},r=self["webpackChunkdachuang"]=self["webpackChunkdachuang"]||[];r.forEach(o.bind(null,0)),r.push=o.bind(null,r.push.bind(r))}();var r=t.O(void 0,[998],(function(){return t(8530)}));r=t.O(r)})();
//# sourceMappingURL=app-legacy.4eadb7a8.js.map