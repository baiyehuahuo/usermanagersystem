(function(){"use strict";var e={5208:function(e,t,a){var o=a(8935),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},["LoginView"!=e.$route.name?a("nav",[a("router-link",{attrs:{to:"/"}},[e._v("Home")]),e._v(" | "),a("router-link",{attrs:{to:"/login"}},[e._v("Login")])],1):e._e(),a("router-view")],1)},s=[],i={created(){this.getUserMessage()}},l=i,n=a(1001),c=(0,n.Z)(l,r,s,!1,null,null,null),d=c.exports,p=a(4549),m=a.n(p);o["default"].use(m());var u=a(2809),h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("el-card",{staticClass:"card",attrs:{shadow:"never"}},[a("el-row",{attrs:{gutter:40}},[a("el-col",{attrs:{span:6}},[e.uploadAvatar.visible?a("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.$http.defaults.baseURL+"/UploadAvatar",name:"avatar","with-credentials":"","show-file-list":!1,"before-upload":e.beforeAvatarUpload,"http-request":e.onAvatarUpload}},[a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]):a("img",{staticClass:"avatar",attrs:{alt:"Avatar",src:e.avatarURL}})],1),a("el-col",{attrs:{span:18}},[a("el-descriptions",{attrs:{title:"用户信息",colon:!1,direction:"vertical",size:"medium",border:""}},[a("template",{slot:"extra"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.updatePasswordForm.dialogVisible=!0}}},[e._v(" 修改密码 ")]),a("el-button",{attrs:{type:e.uploadAvatar.visible?"info":"primary",size:"small"},on:{click:function(t){e.uploadAvatar.visible=!e.uploadAvatar.visible}}},[e._v(" "+e._s(e.uploadAvatar.visible?"取消修改":"修改头像")+" ")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.uploadImage}},[e._v(" 上传图片 ")])],1),a("el-descriptions-item",{attrs:{label:"账号"}},[e._v(" "+e._s(e.$store.state.account)+" ")]),a("el-descriptions-item",{attrs:{label:"邮箱"}},[e._v(" "+e._s(e.$store.state.email)+" ")]),a("el-descriptions-item",{attrs:{label:"昵称"}},[e._v(" "+e._s(e.$store.state.nickname)+" ")])],2)],1)],1)],1),a("el-table",{staticClass:"table",attrs:{data:e.uploadedFiles}},[a("el-table-column",{attrs:{type:"index",label:"#"}}),a("el-table-column",{attrs:{prop:"path",label:"源文件",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{type:"primary",href:"http://"+t.row.path}},[e._v(" "+e._s(e.filename(t.row.path))+" ")])]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.predictImage(t.row.path)}}},[e._v(" 预测 ")]),a("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"确认删除图片？"},on:{confirm:function(a){return e.deleteImage(t.row.path)}}},[a("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v(" 删除 ")])],1)]}}])})],1),a("el-dialog",{attrs:{center:"",title:"修改密码",visible:e.updatePasswordForm.dialogVisible,width:"400px"},on:{"update:visible":function(t){return e.$set(e.updatePasswordForm,"dialogVisible",t)},close:e.clearUpdatePasswordForm}},[a("el-form",{ref:"updatePasswordForm",attrs:{model:e.updatePasswordForm,rules:e.updatePasswordForm.rules}},[a("el-form-item",{attrs:{prop:"oldPassword"}},[a("template",{slot:"label"},[a("strong",[e._v("旧密码")])]),a("el-input",{attrs:{placeholder:"请输入旧密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.updatePasswordForm.oldPassword,callback:function(t){e.$set(e.updatePasswordForm,"oldPassword",t)},expression:"updatePasswordForm.oldPassword"}})],2),a("el-form-item",{attrs:{prop:"newPassword"}},[a("template",{slot:"label"},[a("strong",[e._v("新密码")])]),a("el-input",{attrs:{placeholder:"请输入新密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.updatePasswordForm.newPassword,callback:function(t){e.$set(e.updatePasswordForm,"newPassword",t)},expression:"updatePasswordForm.newPassword"}})],2),a("el-form-item",{attrs:{prop:"confirmNewPassword"}},[a("template",{slot:"label"},[a("strong",[e._v("确认新密码")])]),a("el-input",{attrs:{placeholder:"请确认新密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.updatePasswordForm.confirmNewPassword,callback:function(t){e.$set(e.updatePasswordForm,"confirmNewPassword",t)},expression:"updatePasswordForm.confirmNewPassword"}})],2)],1),a("template",{slot:"footer"},[a("el-button",{staticStyle:{width:"100%"},attrs:{loading:e.updatePasswordForm.loading,type:"primary"},on:{click:e.updatePassword}},[e._v(" 修改密码 ")])],1)],2)],1)},f=[],g=(a(1703),a(6166)),w=a.n(g),v={data(){const e=e=>({required:!0,message:e,trigger:"blur"});return{avatarURL:"",uploadedFiles:[],uploadAvatar:{visible:!1},updatePasswordForm:{loading:!1,dialogVisible:!1,oldPassword:"",newPassword:"",confirmNewPassword:"",rules:{oldPassword:[e("请输入旧密码")],newPassword:[e("请输入新密码"),{validator:(e,t,a)=>{this.updatePasswordForm.oldPassword!==t?a():a(new Error("新旧密码不能一样"))}}],confirmNewPassword:[e("请重复新密码"),{validator:(e,t,a)=>{this.updatePasswordForm.newPassword===t?a():a(new Error("两次密码不一致"))}}]}}}},methods:{filename(e){return this.$R.compose(this.$R.last,this.$R.split("/"))(e)},generateAvatarURL(){return"http://"+this.$store.state.avatarPath+"?q="+Math.random().toFixed(32).slice(2,12)},onAvatarUpload(e){const t=new FormData;t.append("avatar",e.file),w().post("/UploadAvatar",t).then((e=>{const t=e.data;console.log("HomeView onAvatarUpload() /UploadAvatar",t),this.hintUser(t,"上传头像"),200===t.code&&(this.getUserMessage().then((()=>this.avatarURL=this.generateAvatarURL())),this.uploadAvatar.visible=!1)})).catch((e=>{console.error("HomeView onAvatarUpload() /UploadAvatar",e)}))},predictImage(e){const t=new URLSearchParams;t.append("predict_png_name",this.filename(e)),this.$http.get("/PredictPng?"+t).then((({data:e})=>{console.log("predictImage",e),this.hintUser(e,"预测图片"),200===e.code&&this.getUploadedFiles()}))},deleteImage(e){const t=new FormData;t.append("delete_png_name",this.filename(e)),this.$http.post("/DeletePng",t).then((({data:e})=>{console.log("deleteImage",e),this.hintUser(e,"删除图片"),200===e.code&&this.getUploadedFiles()}))},uploadImage(){this.importFile((e=>{const t=new FormData;t.append("png_name",e),this.$http.post("/UploadPng",t).then((({data:e})=>{console.log("UploadPng",e),this.hintUser(e,"上传图片"),200===e.code&&this.getUploadedFiles()}))}),[".png"])},beforeAvatarUpload(e){const t=/^image/.test(e.type),a=e.size/1024/1024<2;return t?a||this.$message.error({showClose:!0,message:"上传头像图片大小不能超过 2MB"}):this.$message.error({showClose:!0,message:"请上传头像图片"}),t&&a},clearUpdatePasswordForm(){this.setToEmpty(this.updatePasswordForm)},async updatePassword(){try{await this.$refs.updatePasswordForm.validate(),console.log("HomeView.vue updatePassword() passed validation")}catch(t){return void console.log("HomeView.vue updatePassword() failed to pass validation")}this.updatePasswordForm.loading=!0;const e=new FormData;e.append("oldPassword",this.updatePasswordForm.oldPassword),e.append("newPassword",this.updatePasswordForm.newPassword),this.$http.post("/ModifyPassword",e).then((({data:e})=>{console.log("HomeView.vue updatePassword /ModifyPassword",e),this.hintUser(e,"修改密码"),200==e.code&&(this.updatePasswordForm.dialogVisible=!1,this.clearUpdatePasswordForm())})).catch((e=>console.error("HomeView.vue updatePassword /ModifyPassword",e))).finally((()=>this.updatePasswordForm.loading=!1))},getUploadedFiles(){this.$http.get("/GetUserFilesPath").then((e=>{const t=e.data;console.log("HomeView getUploadedFiles() /GetUserFilesPath",t),this.hintUserWhenError(t,"获取上传文件"),this.uploadedFiles=this.$R.map(this.$R.objOf("path"))(t.data)})).catch((e=>console.error("HomeView.vue getUploadedFiles()",e)))}},mounted(){this.getUserMessage().then((()=>this.avatarURL=this.generateAvatarURL())),this.getUploadedFiles()}},b=v,P=(0,n.Z)(b,h,f,!1,null,"267682a9",null),y=P.exports,U=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"container"},[a("login-form")],1)},$=[],F=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"login-card"},[a("el-tabs",{attrs:{stretch:""},on:{"tab-click":e.clearForm},model:{value:e.activePanel,callback:function(t){e.activePanel=t},expression:"activePanel"}},[a("el-tab-pane",{attrs:{label:"登陆",name:"login"}},[a("el-form",{ref:"loginForm",staticClass:"login-form",attrs:{model:e.form,rules:e.form.loginRules},nativeOn:{submit:function(t){return t.preventDefault(),e.login.apply(null,arguments)}}},[a("el-form-item",{attrs:{prop:"account"}},[a("template",{slot:"label"},[a("strong",[e._v("账号")])]),a("el-input",{attrs:{placeholder:"请输入账号","prefix-icon":"el-icon-user",clearable:""},model:{value:e.form.account,callback:function(t){e.$set(e.form,"account",t)},expression:"form.account"}})],2),a("el-form-item",{attrs:{prop:"password"}},[a("template",{slot:"label"},[a("strong",[e._v("密码")])]),a("el-input",{attrs:{placeholder:"请输入密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],2),a("el-form-item",[a("el-button",{staticClass:"login-button",attrs:{loading:e.form.loading,type:"primary","native-type":"submit",block:""}},[e._v("登陆")])],1),a("el-link",{staticClass:"forgot-password",attrs:{type:"info"}},[e._v("忘记密码？")])],1)],1),a("el-tab-pane",{attrs:{label:"注册",name:"register"}},[a("el-form",{ref:"registerForm",staticClass:"login-form",attrs:{model:e.form,rules:e.form.registerRules}},[a("el-form-item",{attrs:{prop:"account"}},[a("template",{slot:"label"},[a("strong",[e._v("账号")])]),a("el-input",{attrs:{placeholder:"请输入账号","prefix-icon":"el-icon-user",clearable:""},model:{value:e.form.account,callback:function(t){e.$set(e.form,"account",t)},expression:"form.account"}})],2),a("el-form-item",{attrs:{prop:"email"}},[a("template",{slot:"label"},[a("strong",[e._v("邮箱地址")])]),a("el-input",{attrs:{placeholder:"请输入邮箱","prefix-icon":"el-icon-user",clearable:""},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],2),a("el-form-item",{attrs:{prop:"emailCode"}},[a("el-row",{attrs:{type:"flex",justify:"space-between",gutter:10}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:"请输入验证码",disabled:!e.form.emailValid},model:{value:e.form.emailCode,callback:function(t){e.$set(e.form,"emailCode",t)},expression:"form.emailCode"}})],1),a("el-col",{attrs:{span:8}},[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",disabled:!e.form.emailValid},on:{click:e.sendAuthCode}},[e._v(" 发送验证码 ")])],1)],1)],1),a("el-form-item",{attrs:{prop:"nickname"}},[a("template",{slot:"label"},[a("strong",[e._v("昵称（可选）")])]),a("el-input",{attrs:{placeholder:"请输入昵称","prefix-icon":"el-icon-user",clearable:""},model:{value:e.form.nickname,callback:function(t){e.$set(e.form,"nickname",t)},expression:"form.nickname"}})],2),a("el-form-item",{attrs:{prop:"password"}},[a("template",{slot:"label"},[a("strong",[e._v("密码")])]),a("el-input",{attrs:{placeholder:"请输入密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],2),a("el-form-item",{attrs:{prop:"confirmPassword"}},[a("template",{slot:"label"},[a("strong",[e._v("确认密码")])]),a("el-input",{attrs:{placeholder:"请确认密码",type:"password","prefix-icon":"el-icon-lock","show-password":"",clearable:""},model:{value:e.form.confirmPassword,callback:function(t){e.$set(e.form,"confirmPassword",t)},expression:"form.confirmPassword"}})],2),a("el-form-item",[a("el-button",{staticClass:"login-button",attrs:{loading:e.form.loading,type:"primary",block:""},on:{click:e.register}},[e._v(" 注册 ")])],1),a("el-link",{staticClass:"forgot-password",attrs:{type:"info"}},[e._v("忘记密码？")])],1)],1)],1)],1)},k=[],_={data(){const e={account:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]};return{activePanel:"login",form:{account:"",email:"",emailValid:!1,emailCode:"",nickname:"",password:"",confirmPassword:"",loading:!1,loginRules:e,registerRules:{...e,email:[{validator:async(e,t,a)=>{this.form.emailValid=!1,this.$R.cond([[this.$R.isEmpty,()=>a(new Error("请输入邮箱"))],[this.$R.complement(this.validateEmail),()=>a(new Error("错误的邮箱格式"))]])(t);let{passed:o,msg:r}=await this.checkEmailAvailable(t);o||a(new Error(r)),this.form.emailValid=o,a()},trigger:"blur"}],emailCode:[{required:!0,message:"请输入验证码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(e,t,a)=>{this.form.password===t?a():a(new Error("两次密码不一致"))}}]}}}},methods:{clearForm(){this.$R.pipe(this.$R.keys,this.$R.filter((e=>this.$R.is(String,this.form[e]))),this.$R.map((e=>this.form[e]=this.$R.empty(this.form[e]))))(this.form)},validateEmail(e){return this.$R.compose(this.$R.complement(this.$R.isEmpty),this.$R.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),this.$R.toLower,String)(e)},async login(){let e;if(this.$refs.loginForm.validate((t=>e=t)),!e)return;this.form.loading=!0;const t=new URLSearchParams;t.append("account",this.form.account),t.append("password",this.form.password),await this.$http.get("/UserLogin?"+t).then((e=>{const a=e.data;console.log("LoginForm login() /UserLogin?"+t,a),this.hintUser(a,"用户登录"),200===a.code&&this.getUserMessage()})).catch((e=>{console.error("LoginForm login() /UserLogin?"+t,e)})),this.form.loading=!1},async checkEmailAvailable(e){const t=new URLSearchParams;return t.append("email",e),this.$http.get("/CheckEmailAvailable?"+t).then((({data:e})=>({passed:200===e.code,msg:e.msg}))).catch((()=>({passed:!1,msg:"服务器错误"})))},sendAuthCode(){const e=new URLSearchParams;e.append("email",this.form.email),this.$http.get("/SendAuthCode?"+e).then((({data:e})=>{this.hintUser(e,"发送验证码")})).catch((e=>console.error("LoginForm sendAuthCode() /SendAuthCode",e)))},async register(){let e=await this.$refs.registerForm.validate().then((e=>e)).catch((e=>e));if(!e)return;this.form.loading=!0;const t=new URLSearchParams;t.append("account",this.form.account),t.append("password",this.form.password),t.append("email",this.form.email),t.append("auth_code",this.form.emailCode),t.append("nick_name",this.$R.when(this.$R.isEmpty,this.$R.always(this.form.account))(this.form.nickname)),await this.$http.get("/UserRegister?"+t).then((({data:e})=>{console.log("LoginForm register() /UserRegister?"+t,e),this.hintUser(e),200==e.code&&(this.activePanel="login",this.form.password="")})).catch((e=>{console.error("LoginForm register() /UserRegister?"+t,e)})),this.form.loading=!1}}},R=_,x=(0,n.Z)(R,F,k,!1,null,"36bcb2c2",null),C=x.exports,A={components:{"login-form":C}},L=A,V=(0,n.Z)(L,U,$,!1,null,null,null),E=V.exports;o["default"].use(u.Z);const S=[{path:"/",name:"HomeView",component:y},{path:"/login",name:"LoginView",component:E}],M=new u.Z({routes:S});var O=M,H=a(4665);o["default"].use(H.ZP);var j=new H.ZP.Store({state:{auth:!1,account:"",avatarPath:"",email:"",nickname:""},getters:{},mutations:{login(e,{account:t,avatar_path:a,email:o,nick_name:r}){e.auth=!0,e.account=t,e.avatarPath=a,e.email=o,e.nickname=r},logout(e){e.auth=!1,e.account="",e.avatarPath="",e.email="",e.nickname=""}},actions:{},modules:{}}),Z=a(4398),z=a(9344);function D(e,t=""){m().Message({showClose:!0,message:z.wVM([[z.xbD,z.Bxt(e.msg)],[z.T,t=>t+"："+e.msg]])(t),type:z.wVM([[z.fS0(200),z.Bxt("success")],[z.T,z.Bxt("error")]])(e.code)})}function T(e,t=""){z.gxm(z.qCK(z.ffD,z.OH4("code",200)),(()=>D(e,t)))(e)}async function q(){try{const e=await w().get("/GetUserMessage"),t=e.data;console.log("main getUserMessage()",t),T(t,"获取用户信息"),200===t.code?(j.commit("login",t.data),"HomeView"!=O.currentRoute.name&&O.push({name:"HomeView"})):(j.commit("logout"),"LoginView"!=O.currentRoute.name&&O.push({name:"LoginView"}))}catch(e){console.error("main getUserMessage()",e),j.commit("logout"),"LoginView"!=O.currentRoute.name&&O.push({name:"LoginView"})}}function I(e,t=[]){const a=document.createElement("input");a.type="file",a.multiple=!1,a.accept=z.KJl(z.xbD,z.Bxt("*"),z.v_p(","))(t),a.oninput=()=>{e(z.YMb(a.files))},a.click()}o["default"].use(Z.Z),o["default"].config.productionTip=!1,o["default"].prototype.$http=w(),w().defaults.withCredentials=!0,w().defaults.baseURL="http://localhost:8080",o["default"].mixin({methods:{hintUser:D,hintUserWhenError:T,getUserMessage:q,importFile:I,setToEmpty(e){for(let t of Object.keys(e))e[t]=z.cSb(e[t])}}}),new o["default"]({router:O,store:j,render:e=>e(d)}).$mount("#app")}},t={};function a(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,a),s.exports}a.m=e,function(){var e=[];a.O=function(t,o,r,s){if(!o){var i=1/0;for(d=0;d<e.length;d++){o=e[d][0],r=e[d][1],s=e[d][2];for(var l=!0,n=0;n<o.length;n++)(!1&s||i>=s)&&Object.keys(a.O).every((function(e){return a.O[e](o[n])}))?o.splice(n--,1):(l=!1,s<i&&(i=s));if(l){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[o,r,s]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,o){var r,s,i=o[0],l=o[1],n=o[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(n)var d=n(a)}for(t&&t(o);c<i.length;c++)s=i[c],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(d)},o=self["webpackChunkdachuang"]=self["webpackChunkdachuang"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=a.O(void 0,[998],(function(){return a(5208)}));o=a.O(o)})();
//# sourceMappingURL=app.a34bdef0.js.map